<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="shortcut icon" href="/img/CM.png" type="image/x-icon">
    <link rel="stylesheet" href="css/cadastro.css">
    <title>Cadastro</title>
</head>

<body>
    <div class="container">
        <div class="forms-image">
            <img src="img/oiteiro (gibson).jpg">
        </div>
        <div class="forms">
            <form id="cadastroForm"> <!-- Adicionado o id para vincular com o script -->
                <div class="forms-header">
                    <div class="title">
                        <h1>Cadastre-se</h1>
                    </div>
                    <div class="login-button">
                        <button><a href="login.html">Entrar</a></button>
                    </div>
                </div>

                <div class="input-group">
                    <div class="input-box">
                        <label for="name">Nome Completo</label>
                        <input type="text" id="name" placeholder="Nome Completo" required>
                    </div>

                    <div class="input-box">
                        <label for="date">Data de nascimento</label>
                        <input type="date" id="date" placeholder="Data de Nascimento" required>
                    </div>

                    <div class="input-box">
                        <label for="email">Email</label>
                        <input type="email" id="email" placeholder="Email" required>
                    </div>

                    <div class="input-box">
                        <label for="phone">Celular</label>
                        <input type="tel" id="phone" pattern="^\(\d{2}\) \d{1} \d{4}-\d{4}$" placeholder="(xx) x xxxx-xxxx" required>
                    </div>

                    <div class="input-box">
                        <label for="address">Endereço</label>
                        <input type="text" id="address" placeholder="Endereço" required>
                    </div>

                    <div class="input-box">
                        <label for="complement">Complemento</label>
                        <input type="text" id="complement" placeholder="Complemento">
                    </div>

                    <div class="input-box">
                        <label for="responsavel-phone">Celular do Responsável</label>
                        <input type="tel" id="responsavel-phone" pattern="^\(\d{2}\) \d{1} \d{4}-\d{4}$" placeholder="(xx) x xxxx-xxxx" required>
                    </div>
                    
                    <div class="input-box">
                        <label for="password">Senha</label>
                        <input type="password" id="password" placeholder="Até 5 caracteres" required>
                    </div>

                    <div class="input-box">
                        <label for="confirm-password">Confirme sua senha</label>
                        <input type="password" id="confirm-password" placeholder="Digite novamente" required>
                    </div>
                </div>

                <div class="gender-inputs">
                    <div class="gender-title">
                        <h6>Gênero</h6>
                    </div>

                    <div class="gender-group">
                        <div class="gender-input">
                            <input type="radio" id="female" name="gender" value="Feminino">
                            <label for="female">Feminino</label>
                        </div>

                        <div class="gender-input">
                            <input type="radio" id="male" name="gender" value="Masculino">
                            <label for="male">Masculino</label>
                        </div>

                        <div class="gender-input">
                            <input type="radio" id="others" name="gender" value="Outros">
                            <label for="others">Outros</label>
                        </div>

                        <div class="gender-input">
                            <input type="radio" id="none" name="gender" value="Prefiro não dizer">
                            <label for="none">Prefiro não dizer</label>
                        </div>
                    </div>
                </div>

                <div class="heart">
                    <div class="heart-title">
                        <h6>Doença Cardiovascular?</h6>   
                    </div>
                    
                    <div class="heart-input">
                        <input type="radio" id="heart-yes" name="heart-disease" value="Sim">
                        <label for="heart-yes">Sim</label>
                    </div>

                    <div class="heart-input">
                        <input type="radio" id="heart-no" name="heart-disease" value="Não">
                        <label for="heart-no">Não</label>
                    </div>
                </div>

                <div class="continue-button">
                    <input type="submit" value="Salvar">
                </div>
            </form>
        </div>
    </div>

    <!-- Adicione o Firebase SDK e a lógica de cadastro -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.17.2/firebase-app.js";
        import { getAuth, createUserWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/9.17.2/firebase-auth.js";
        import { getFirestore, doc, setDoc } from "https://www.gstatic.com/firebasejs/9.17.2/firebase-firestore.js";

        // Configuração do Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyCMCR42h8ZM4ao4D5MSTZkg99PIhspSAZE",
            authDomain: "pulso-da-historia.firebaseapp.com",
            projectId: "pulso-da-historia",
            storageBucket: "pulso-da-historia.appspot.com",
            messagingSenderId: "285634655113",
            appId: "1:285634655113:web:7e97210e9c6b2878d96758"
        };

        // Inicializa o Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth();
        const db = getFirestore();

        // Função para salvar dados do usuário no Firestore
        const saveUserData = async (userId, userData) => {
            try {
                await setDoc(doc(db, "usuarios", userId), userData);
                alert("Usuário cadastrado com sucesso!");
            } catch (error) {
                console.error("Erro ao salvar dados no Firestore:", error);
                alert("Erro ao salvar dados do usuário no Firestore: " + error.message);
            }
        };

        // Lidar com o envio do formulário
        const cadastroForm = document.getElementById('cadastroForm');
        cadastroForm.addEventListener('submit', async (event) => {
            event.preventDefault();

            // Capturar os dados do formulário
            const name = document.getElementById('name').value;
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            const confirmPassword = document.getElementById('confirm-password').value;
            const dateOfBirth = document.getElementById('date').value;
            const phone = document.getElementById('phone').value;
            const address = document.getElementById('address').value;
            const complement = document.getElementById('complement').value;
            const responsavelPhone = document.getElementById('responsavel-phone').value;
            const gender = document.querySelector('input[name="gender"]:checked').value;
            const heartDisease = document.querySelector('input[name="heart-disease"]:checked').value;

            // Verificar se as senhas correspondem
            if (password !== confirmPassword) {
                alert("As senhas não coincidem!");
                return;
            }

            try {
                // Criar usuário no Firebase Authentication
                const userCredential = await createUserWithEmailAndPassword(auth, email, password);
                const user = userCredential.user;

                // Dados a serem salvos no Firestore
                const userData = {
                    nome: name,
                    email: email,
                    data_nascimento: dateOfBirth,
                    celular: phone,
                    endereco: address,
                    complemento: complement,
                    celular_responsavel: responsavelPhone,
                    genero: gender,
                    doenca_cardiovascular: heartDisease
                };

                // Salvar os dados do usuário no Firestore
                await saveUserData(user.uid, userData);

            } catch (error) {
                console.error("Erro ao criar usuário:", error);
                
                // Mostrar mensagens de erro mais claras
                if (error.code === 'auth/email-already-in-use') {
                    alert("Este email já está em uso!");
                } else if (error.code === 'auth/invalid-email') {
                    alert("O email fornecido é inválido!");
                } else if (error.code === 'auth/weak-password') {
                    alert("A senha é muito fraca! Deve ter pelo menos 6 caracteres.");
                } else {
                    alert("Erro ao criar usuário: " + error.message);
                }
            }
        });
    </script>
</body>

</html>
